---
import Layout from "../../layouts/Layout.astro";
import ContactForm from "../../components/ContactForm";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import { generateBreadcrumbs } from "../../util/generateBreadcrumbs";
import globalText from "../../data/globalText.json";
import contactText from "../../data/contactText.json";
import contactBackgroundImageSrc from "../../assets/contactBackground.webp";
import { getImage } from "astro:assets";

const contactBackgroundImage = await getImage({ src: contactBackgroundImageSrc });
interface Props {
  pageTitle: string;
}

const pageTitle = "Contact";

// reCAPTCHA設定
const RECAPTCHA_SITE_KEY = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY as string | undefined;

const jsonLd = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "ContactPage",
  name: pageTitle,
  description: `${globalText.contact.description}`,
  url: `${globalText.url}/contact`,
});

const crumbs = generateBreadcrumbs(Astro.url.pathname);

// 静的サイト生成でpagefindを使用するため、prerenderをtrueに設定
export const prerender = true;
---

<Layout
  title={globalText.contact.title}
  description={globalText.contact.description}
  ogType={globalText.local.type}
  ogTitle={globalText.contact.title}
  ogDescription={globalText.contact.description}
  twitterTitle={globalText.contact.title}
  twitterDescription={globalText.contact.description}
  jsonLd={jsonLd}
>
  <link slot="head" rel="preload" href={contactBackgroundImage.src} as="image" fetchpriority="high" />
  {RECAPTCHA_SITE_KEY && (
    <script
      slot="head"
      src={`https://www.google.com/recaptcha/api.js?render=${RECAPTCHA_SITE_KEY}`}
      async
      defer
    />
  )}

  <div class="breadcrumbs__wrapper">
    <Breadcrumbs {crumbs} />
  </div>
  <div class="contact" style={`background-image: url(${contactBackgroundImage.src})`}>
    <div class="contact__wrapper">
      <h1 class="contact__title" id="contact-form-title">
        {pageTitle}
      </h1>
      {
        contactText.contact.body.map(({ text }) => (
          <p id="contact-form-description" class="contact__body" set:html={text} />
        ))
      }
      <p id="contact-form-description" class="contact__body">
        <span class="contact__body--required">【必須】</span>のついた項目は必ずご記入ください。
      </p>
      <div class="contactForm">
        <ContactForm client:visible />
      </div>
    </div>
  </div>
</Layout>

<style is:global>
  .contact {
    width: 100%;
    min-height: 100vh;
    color: var(--color-black);
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
    overflow: auto;
    padding-block: 4rem;
  }
  .contact__wrapper {
    width: 100%;
    max-width: 700px;
    margin-inline: auto;
  }
  @media (width <= 480px) {
    .contact__wrapper {
      width: 90%;
    }
  }
  .contact__title {
    font-size: 2rem;
    line-height: 1.5;
    text-align: center;
  }
  .contact__body {
    width: 100%;
    max-width: 312px;
    display: block;
    font-size: 0.9375rem;
    line-height: 1.8;
    letter-spacing: 0.06em;
    text-align: left;
    margin-inline: auto;
  }

  .contact__body:first-of-type {
    margin-block-start: 1rem;
  }
  @media (width <= 480px) {
    .contact__body {
      max-width: 330px;
      text-align: justify;
      padding-inline: 0.5rem;
    }
  }
  .contact__body--required {
    color: var(--color-red);
  }
</style>
