---
import RiveComponent from "./RiveComponent.tsx";

interface GridRiveProps {
  className: string;
  href: string;
  ariaLabel: string;
  ariaTitle: string;
  src: string;
  tooltipText: string;
  tooltipPosition: string;
  stateMachines?: string | string[];
}

const { className, href, ariaLabel, ariaTitle, src, tooltipText, tooltipPosition, stateMachines } =
  Astro.props as GridRiveProps;
---

<li class={`grid__menu_item ${className}`}>
  <a class="grid__menu_link" href={href} aria-label={ariaLabel} title={ariaTitle}>
    <div class="grid__menu_rive">
      <RiveComponent src={src} stateMachines={stateMachines} minWidth={100} minHeight={100} client:only="react" />
    </div>
    <span class={`item__tooltip_${tooltipPosition}`}>
      {tooltipText}
    </span>
  </a>
</li>

<style is:global>
  .grid__menu_item .grid__menu_rive {
    width: 100%;
    height: 100%;
    background: #ffffff;
    border-radius: 0.5rem;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    perspective: 1000px;
    transition: all 0.2s linear;
    /* 高品質レンダリング設定 */
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
  }
  .grid__menu_item .grid__menu_rive:is(:hover, :focus-visible) {
    border-radius: 50%;
    transform: scale(1.15) translateZ(0);
  }
  .rive-container {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    /* 高品質レンダリング設定 */
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  .rive-component {
    width: 100%;
    height: 100%;
    /* 高品質画像レンダリング */
    image-rendering: high-quality;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    /* アンチエイリアシング強化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* レンダリング品質向上 */
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: transform;
  }

  .grid__menu_rive canvas {
    width: 100% !important;
    height: 100% !important;
    min-width: 100px !important;
    min-height: 100px !important;
    object-fit: contain;
    vertical-align: middle;
    display: block;
    /* 高品質画像レンダリング */
    image-rendering: high-quality;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    /* アンチエイリアシング強化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* レンダリング品質向上 */
    transform: translateZ(0);
    backface-visibility: hidden;
    will-change: transform;
    /* 高DPI対応 */
    image-rendering: -webkit-optimize-contrast;
    /* パフォーマンス最適化 */
    contain: layout style paint;
  }

  /* ローディング状態のスタイル */
  .rive-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 0.5rem;
    z-index: 10;
  }

  .rive-loading-spinner {
    width: 24px;
    height: 24px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  /* 高DPI対応の追加設定 */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .grid__menu_rive canvas {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  }

  /* 高DPI対応の追加設定（Retinaディスプレイ） */
  @media (-webkit-min-device-pixel-ratio: 3), (min-resolution: 288dpi) {
    .grid__menu_rive canvas {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  }
</style>
