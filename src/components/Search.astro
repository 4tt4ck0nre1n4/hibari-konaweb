---
import "@pagefind/default-ui/css/ui.css";
---

<div id="search"></div>

<script>
  import { PagefindUI } from "@pagefind/default-ui";

  document.addEventListener("DOMContentLoaded", () => {
    new PagefindUI({
      element: "#search",
      showImages: true,
    });

    // スマホサイズでのみ検索ボックスのborderを強制的に設定
    const applyBorderStyle = () => {
      const searchInput = document.querySelector("#search .pagefind-ui__search-input") as HTMLInputElement;
      if (searchInput) {
        // スマホサイズかどうかをチェック
        if (window.innerWidth <= 480) {
          searchInput.style.border = "1px solid aqua";
          searchInput.style.borderColor = "aqua";
          searchInput.style.setProperty("border", "1px solid aqua", "important");
        } else {
          // パソコンサイズではborderをリセット
          searchInput.style.border = "";
          searchInput.style.borderColor = "";
          searchInput.style.removeProperty("border");
        }
      }
    };

    // 複数のタイミングでスタイルを適用
    setTimeout(applyBorderStyle, 100);
    setTimeout(applyBorderStyle, 500);
    setTimeout(applyBorderStyle, 1000);

    // ウィンドウリサイズ時にスタイルを再適用
    window.addEventListener("resize", applyBorderStyle);

    // MutationObserverでDOMの変更を監視
    const searchContainer = document.querySelector("#search");
    if (searchContainer) {
      const observer = new MutationObserver(() => {
        applyBorderStyle();
      });

      observer.observe(searchContainer, {
        childList: true,
        subtree: true,
      });
    }
  });
</script>

<style>
  #search {
    height: auto;
    background: white;
    border-radius: 0.5rem;
    border: 1px solid gray;
    transition-duration: 300ms;
    position: relative; /* Clock.astroと同じposition設定 */
  }

  #search:not(:has(.pagefind-ui__hidden)) {
    width: 100%;
    min-height: 14vh; /* Clock.astroと同じ高さ基準 */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    border-radius: 1rem;
    padding: 0.5rem; /* Clock.astroと同じパディング */
    box-sizing: border-box; /* Clock.astroと同じボックスサイズ */
  }

  @media screen and (max-width: 480px) {
    #search {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 12vh; /* モバイル版のClock.astroと同じ高さ */

      padding: 0.25rem; /* Clock.astroと同じパディング */
    }
  }

  /* iPhone特有の調整 */
  @media screen and (max-width: 480px) and (-webkit-min-device-pixel-ratio: 2) {
    #search {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 14vh; /* iPhone版のClock.astroと同じ高さ */
      padding: 0.25rem;
    }
  }

  /* Pagefind UIの検索ボックスのスタイル調整 */
  #search .pagefind-ui__search-input {
    font-size: 1rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    width: 100%;
    max-width: 400px; /* 最大幅を制限 */
  }

  @media screen and (max-width: 480px) {
    #search .pagefind-ui__search-input {
      font-size: 0.9rem; /* モバイルでは少し小さく */
      max-width: 100%; /* モバイルでは全幅使用 */
      margin: 0 auto; /* 中央配置 */
      padding: 0.5rem;
      border: 1px solid aqua !important;
    }

    /* スマホサイズでのPagefind UIのコンテナ全体を中央配置 */
    #search .pagefind-ui {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
  }
</style>
