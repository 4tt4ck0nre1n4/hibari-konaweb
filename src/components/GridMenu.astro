---
import GridSvg from "./GridSvg.astro";
import gridText from "../data/gridText.json";
import { hrefLink } from "../scripts/constLinks";
import aboutCat from "../assets/svg/about-cat.svg";
import blogCat from "../assets/svg/blog-cat.svg";
import contactCat from "../assets/svg/contact-cat.svg";
import worksCat from "../assets/svg/works-cat.svg";
import homeCat from "../assets/svg/home-cat.svg";
import andMoreCat from "../assets/svg/andMore-cat.svg";
import sodenoura from "../assets/svg/sodenoura.svg";
import gaura from "../assets/svg/gauraStudio.svg";
import pikucha from "../assets/svg/pikucha.svg";
import sodenoura2 from "../assets/svg/sodenoura2.svg";
import gauraStudio2 from "../assets/svg/gauraStudio2.svg";
import pikucha2 from "../assets/svg/pikucha2.svg";
---

<ul id="js-grid__menu" class="grid__menu">
  <GridSvg
    className="item-1"
    href={hrefLink.about}
    ariaLabel={gridText.gridItem1.ariaLabel}
    ariaTitle={gridText.gridItem1.ariaTitle}
    imageSrc={aboutCat}
    imageMeta={gridText.gridItem1.Alt}
    tooltipText={gridText.gridItem1.tooltipText}
    tooltipPosition={gridText.gridItem1.tooltipPosition}
  />
  <GridSvg
    className="item-2"
    href={hrefLink.blog}
    ariaLabel={gridText.gridItem2.ariaLabel}
    ariaTitle={gridText.gridItem2.ariaTitle}
    imageSrc={blogCat}
    imageMeta={gridText.gridItem2.Alt}
    tooltipText={gridText.gridItem2.tooltipText}
    tooltipPosition={gridText.gridItem2.tooltipPosition}
  />
  <GridSvg
    className="item-3"
    href={hrefLink.contact}
    ariaLabel={gridText.gridItem3.ariaLabel}
    ariaTitle={gridText.gridItem3.ariaTitle}
    imageSrc={contactCat}
    imageMeta={gridText.gridItem3.Alt}
    stateMachines="State Machine 1"
    tooltipText={gridText.gridItem3.tooltipText}
    tooltipPosition={gridText.gridItem3.tooltipPosition}
  />
  <GridSvg
    className="item-4"
    href={hrefLink.works}
    ariaLabel={gridText.gridItem4.ariaLabel}
    ariaTitle={gridText.gridItem4.ariaTitle}
    imageSrc={worksCat}
    imageMeta={gridText.gridItem4.Alt}
    stateMachines="State Machine 1"
    tooltipText={gridText.gridItem4.tooltipText}
    tooltipPosition={gridText.gridItem4.tooltipPosition}
  />
  <GridSvg
    className="item-5"
    href={hrefLink.home}
    ariaLabel={gridText.gridItem5.ariaLabel}
    ariaTitle={gridText.gridItem5.ariaTitle}
    imageSrc={homeCat}
    imageMeta={gridText.gridItem5.Alt}
    stateMachines="State Machine 1"
    tooltipText={gridText.gridItem5.tooltipText}
    tooltipPosition={gridText.gridItem5.tooltipPosition}
  />
  <GridSvg
    className="item-6"
    href={hrefLink.home}
    ariaLabel={gridText.gridItem6.ariaLabel}
    ariaTitle={gridText.gridItem6.ariaTitle}
    imageSrc={andMoreCat}
    imageMeta={gridText.gridItem6.Alt}
    stateMachines="State Machine 1"
    tooltipText={gridText.gridItem6.tooltipText}
    tooltipPosition={gridText.gridItem6.tooltipPosition}
  />
  <GridSvg
    className="item-7 logoSvg-visible"
    href={hrefLink.work1}
    ariaLabel={gridText.gridItem7.ariaLabel}
    ariaTitle={gridText.gridItem7.ariaTitle}
    imageSrc={sodenoura}
    imageMeta={gridText.gridItem7.Alt}
    tooltipText={gridText.gridItem7.tooltipText}
    tooltipPosition={gridText.gridItem7.tooltipPosition}
  />
  <GridSvg
    className="item-8 logoSvg-visible"
    href={hrefLink.work2}
    ariaLabel={gridText.gridItem8.ariaLabel}
    ariaTitle={gridText.gridItem8.ariaTitle}
    imageSrc={gaura}
    imageMeta={gridText.gridItem8.Alt}
    tooltipText={gridText.gridItem8.tooltipText}
    tooltipPosition={gridText.gridItem8.tooltipPosition}
  />
  <GridSvg
    className="item-9 logoSvg-visible"
    href={hrefLink.work3}
    ariaLabel={gridText.gridItem9.ariaLabel}
    ariaTitle={gridText.gridItem9.ariaTitle}
    imageSrc={pikucha}
    imageMeta={gridText.gridItem9.Alt}
    tooltipText={gridText.gridItem9.tooltipText}
    tooltipPosition={gridText.gridItem9.tooltipPosition}
  />
  <GridSvg
    className="item-10 logoSvg-hidden"
    href={hrefLink.work1}
    ariaLabel={gridText.gridItem10.ariaLabel}
    ariaTitle={gridText.gridItem10.ariaTitle}
    imageSrc={sodenoura2}
    imageMeta={gridText.gridItem10.Alt}
    tooltipText={gridText.gridItem10.tooltipText}
    tooltipPosition={gridText.gridItem10.tooltipPosition}
  />
  <GridSvg
    className="item-11 logoSvg-hidden"
    href={hrefLink.work2}
    ariaLabel={gridText.gridItem11.ariaLabel}
    ariaTitle={gridText.gridItem11.ariaTitle}
    imageSrc={gauraStudio2}
    imageMeta={gridText.gridItem11.Alt}
    tooltipText={gridText.gridItem11.tooltipText}
    tooltipPosition={gridText.gridItem11.tooltipPosition}
  />
  <GridSvg
    className="item-12 logoSvg-hidden"
    href={hrefLink.work3}
    ariaLabel={gridText.gridItem12.ariaLabel}
    ariaTitle={gridText.gridItem12.ariaTitle}
    imageSrc={pikucha2}
    imageMeta={gridText.gridItem12.Alt}
    tooltipText={gridText.gridItem12.tooltipText}
    tooltipPosition={gridText.gridItem12.tooltipPosition}
  />
</ul>

<style is:global>
  .grid__menu {
    width: 100%;
    height: 100%;
    min-height: 408px; /* CLS対策: グリッドアイテム(100px x 4行) + gap + padding */
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 1rem;
    justify-items: center;
    list-style: none;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.6);
    border-radius: 1rem;
    position: relative;
    z-index: 1;
    overflow: hidden;
    padding-block: 1.5rem;
    transform-origin: center;
    transition: box-shadow 0.4s ease;
  }
  .grid__menu:is(:hover, :focus-visible) {
    box-shadow: 0 16px 8px rgb(0 0 0 / 0.6);
  }
  html.dark .grid__menu:is(:hover, :focus-visible) {
    box-shadow: 0 16px 8px rgb(255 255 255 / 0.6);
  }
  .grid__menu::before {
    content: "";
    width: 100%;
    max-width: 560px;
    height: 100%;
    max-height: 480px;
    display: block;
    background: var(--gradient-shinePurple);
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
    transform: translateX(-200px) skew(-16deg);
    animation: shineGrid 6s linear infinite;
  }
  @keyframes shineGrid {
    0% {
      transform: translateX(-200px) skew(-16deg);
      opacity: 0;
    }
    8% {
      opacity: 1;
    }
    48% {
      transform: translateX(200px) skew(-16deg);
      opacity: 0.9;
    }
    56% {
      opacity: 0.3;
    }
    100% {
      transform: translateX(-200px) skew(-16deg);
      opacity: 0;
    }
  }
  .grid__menu_item {
    width: 100px;
    height: 100px;
    background-color: var(--color-white);
    border-radius: 0.625rem;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.6);
    position: relative;
    transition:
      background 0.4s ease-in-out,
      box-shadow 0.4s ease;
  }
  .grid__menu_item:is(:hover, :focus-visible) {
    background: transparent;
  }
  .grid__menu_item .grid__menu_link {
    display: block;
  }
  .grid__menu_item .grid__menu_link::before {
    position: absolute;
    content: "";
    transform: scale(0);
    opacity: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: color-mix(in srgb, var(--white) 20%, transparent);
  }
  .grid__menu_item .grid__menu_svg {
    width: 100%;
    height: 100%;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    transition: transform 0.4s ease;
  }
  .item-1,
  .item-2,
  .item-3 {
  }
  .item-7,
  .item-8,
  .item-9 {
    background: transparent;
  }

  /* item-10, item-11, item-12は初期状態で非表示 */
  .logoSvg-hidden {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
  }

  .logoSvg-visible {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  .grid__menu_item .grid__menu_svg:is(:hover, :focus-visible) {
    transform: scale(1.1);
  }

  .grid__menu_svg img {
    width: 100%;
    height: 100%;
    border-radius: 0.625rem;
    object-fit: contain;
    image-rendering: high-quality;
    image-rendering: -webkit-optimize-contrast;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  /* .webp画像に明示的にobject-fit: containを指定し、鮮明な表示を実現 */
  .grid__menu_item.item-10 .grid__menu_svg img,
  .grid__menu_item.item-11 .grid__menu_svg img,
  .grid__menu_item.item-12 .grid__menu_svg img {
    object-fit: contain;
    /* 画像を鮮明に表示するための設定 */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    /* ブラウザの最適化を無効化して高品質レンダリング */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    /* GPUアクセラレーションを有効化 */
    transform: translateZ(0);
    will-change: transform;
    /* アンチエイリアシングの最適化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .grid__menu_item:not(.item-4, .item-5, .item-6) .grid__menu_svg {
    /* background: transparent; */
    box-shadow: 0 0 0 rgb(0 0 0 / 0.1);
    animation: translateGridImage 20s linear infinite;
    animation-play-state: running;
  }
  .grid__menu_item:not(.item-4, .item-5, .item-6):is(:hover, :focus-visible) .grid__menu_svg {
    animation-play-state: paused;
    box-shadow: 0 12px 12px rgb(0 0 0 / 0.6);
    border-radius: 0.5rem;
    transition:
      border-radius 0.4s ease,
      box-shadow 0.4s ease;
  }
  @keyframes translateGridImage {
    0% {
      transform: translateY(0);
    }
    25% {
      transform: translateY(-8px);
    }
    50% {
      transform: translateY(0);
    }
    75% {
      transform: translateY(8px);
    }
    100% {
      transform: translateY(0);
    }
  }
  .item__tooltip_right {
    font-size: 0.875rem;
    color: var(--color-black);
    background-color: var(--color-white);
    box-shadow: 0px 10px 20px rgb(0 0 0 / 0.6);
    white-space: nowrap;
    border: #ccc 1px solid;
    border-radius: 0.625rem;
    pointer-events: none;
    position: absolute;
    bottom: -10%;
    left: 120%;
    opacity: 0;
    transform: translateX(-50%);
    transition: opacity 0.3s ease;
    padding: 0.5rem;
  }
  .item__tooltip_left {
    font-size: 0.875rem;
    color: var(--color-black);
    background-color: var(--color-white);
    box-shadow: 0px 10px 20px rgb(0 0 0 / 0.6);
    white-space: nowrap;
    border: #ccc 1px solid;
    border-radius: 0.625rem;
    pointer-events: none;
    position: absolute;
    bottom: -10%;
    left: -25%;
    opacity: 0;
    transform: translateX(-50%);
    transition: opacity 0.3s ease;
    padding: 0.5rem;
  }
  .item__tooltip_right::before {
    display: inline-block;
    content: "";
    border: transparent 12px solid;
    border-left: var(--color-white) 12px solid;
    position: absolute;
    bottom: 68%;
    right: 36%;
  }
  .item__tooltip_left::before {
    display: inline-block;
    content: "";
    border: transparent 12px solid;
    border-right: var(--color-white) 12px solid;
    position: absolute;
    bottom: 68%;
    left: 36%;
  }

  /* タブレット・スマホサイズでのレスポンシブ対応 */
  @media (width <= 768px) {
    .grid__menu {
      gap: 0.5rem;
    }
  }

  /* 480px以下での超小型スマホ最適化 */
  @media (width <= 480px) {
    .grid__menu {
      gap: 0.25rem;
    }
  }

  @media (width <= 480px) and (-webkit-min-device-pixel-ratio: 2) {
    .grid__menu {
      padding-inline: 0.5rem;
    }
  }
</style>

<!-- TBT改善: インラインスクリプトを外部ファイルに移動し、requestIdleCallbackで遅延初期化 -->
<script>
  import { initGridMenuAnimationsDeferred } from "../scripts/gridMenuAnimations";

  // 初期化関数
  function loadGridMenuAnimations() {
    initGridMenuAnimationsDeferred();
  }

  // 明示的に初期化を実行
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", loadGridMenuAnimations);
  } else {
    loadGridMenuAnimations();
  }

  // View Transitions対応: ページ遷移時に再初期化
  document.addEventListener("astro:after-swap", () => {
    loadGridMenuAnimations();
  });
</script>
