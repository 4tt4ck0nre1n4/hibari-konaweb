---

---

<button
  id="clockIcon"
  type="button"
  aria-label="時計の表示を切り替える（時計あり）"
  title="時計の表示を切り替える（時計あり）"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 64 64">
    <g class="offClock clockIcon-visible" transform="scale(1)" aria-hidden="true">
      <circle class="offClock" cx="32.04" cy="32.04" r="29.68" fill="#e0e7ec"> </circle>
      <path
        class="offClock clockIcon-visible"
        fill="#98a9b4"
        d="M0 32.04c0 17.666 14.372 32.04 32.04 32.04c17.666 0 32.04-14.372 32.04-32.04S49.706 0 32.04 0S0 14.372 0 32.04m6.237 0c0-14.228 11.575-25.803 25.801-25.803c14.228 0 25.803 11.575 25.803 25.803S46.266 57.843 32.038 57.843c-14.226 0-25.801-11.575-25.801-25.803"
      >
      </path>
      <path
        class="offClock clockIcon-visible"
        fill="#85939c"
        d="M33.922 10.89c0-1.443-.85-2.609-1.893-2.609c-1.042 0-1.893 1.166-1.893 2.609V32c0 1.442.851 2.608 1.893 2.608s1.893-1.166 1.893-2.608z"
      >
      </path>
      <path
        class="offClock clockIcon-visible"
        fill="#788288"
        d="M48.02 34.77c1.438 0 2.607-.852 2.607-1.896c0-1.041-1.17-1.891-2.609-1.891l-15.276-.004c-1.438 0-2.607.851-2.605 1.891c-.002 1.044 1.167 1.896 2.6 1.896z"
      >
      </path>
    </g>

    <path
      class="onClock clockIcon-hidden"
      fill="#c2986b"
      d="M6.128 61.66c-.215-.293.406-2.372.532-2.521c3.271-3.808 3.391-16.06 3.324-17.806c-.164-4.03 1.972-8.106 3.774-7.225c1.74.85 3.104 9.23 3.439 10.907c.827 4.101.503 9.01-.825 12.898c-1.402 4.117-6.821 8.295-10.244 3.747m51.847 0c.214-.293-.406-2.372-.533-2.521c-3.271-3.808-3.39-16.06-3.323-17.806c.163-4.03-1.973-8.106-3.775-7.225c-1.739.85-3.103 9.23-3.438 10.907c-.827 4.101-.503 9.01.825 12.898c1.401 4.117 6.82 8.295 10.244 3.747"
    >
    </path>
    <path
      class="onClock clockIcon-hidden"
      fill="#fbb041"
      d="M2.421 17.334c2.16 2.161 7.245.573 11.367-3.55c4.12-4.12 5.708-9.203 3.548-11.365C15.181.266 6.522-1.72 2.4 2.4c-4.12 4.12-2.134 12.781.021 14.934m58.999 0c-2.159 2.161-7.244.573-11.366-3.55c-4.12-4.12-5.708-9.203-3.549-11.365C48.661.266 57.319-1.72 61.441 2.4c4.12 4.12 2.134 12.781-.021 14.934"
    >
    </path>
    <path
      class="onClock clockIcon-hidden"
      fill="#a7a8ac"
      d="M60.809 33.07c0 15.979-12.95 28.932-28.93 28.932S2.948 49.05 2.948 33.07c0-15.976 12.95-27.1 28.93-27.1s28.931 11.123 28.931 27.1"
    >
    </path>
    <path
      class="onClock clockIcon-hidden"
      fill="#e7e6e6"
      d="M53.53 33.3c0 11.961-9.694 21.656-21.656 21.656S10.218 45.261 10.218 33.3c0-11.958 9.695-20.283 21.656-20.283S53.53 21.342 53.53 33.3"
    >
    </path>
    <g class="onClock clockIcon-hidden" fill="#25333a" aria-hidden="true">
      <path
        class="onClock clockIcon-hidden"
        d="M34.555 35.13c0 1.756-1.395 3.176-3.117 3.176s-3.117-1.42-3.117-3.176V20.204c0-1.751 1.395-3.171 3.117-3.171c1.723 0 3.117 1.42 3.117 3.171z"
      ></path>
      <path
        class="onClock clockIcon-hidden"
        d="M31.625 38.31c-1.828 0-3.305-.968-3.305-2.161c0-1.19 1.477-2.157 3.305-2.157h15.557c1.827 0 3.308.967 3.308 2.157c0 1.193-1.48 2.161-3.308 2.161z"
      ></path>
    </g>
  </svg>
</button>
<p id="ariaLiveStatus__clockIcon" class="screenReader-only" role="status" aria-live="polite"></p>

<style>
  #clockIcon {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--color-white);
    border: transparent 1px solid;
    border-radius: 1rem;
    box-shadow: 0 8px 16px rgb(0 0 0 / 0.6);
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 60px;
    transition:
      transform 0.1s ease,
      background 0.4s ease-in-out,
      box-shadow 0.4s ease;
  }
  #clockIcon:is(:hover, :focus-visible) {
    background: transparent;
    box-shadow: 0 16px 8px rgb(0 0 0 / 0.6);
  }
  #clockIcon:active {
    background: transparent;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.4);
    transform: scale(0.8);
  }
  #clockIcon svg {
    width: 40px;
    height: 40px;
    display: inline-flex;
    filter: drop-shadow(10px 20px 20px rgb(160 160 160 / 0.7));
    position: relative;
    transition: transform 0.35s ease;
  }
  #clockIcon svg:is(:hover, :focus-visible) {
    transform: scale(1.1);
  }
  .offClock {
    opacity: 1;
    transition:
      opacity 1.8s ease,
      transform 0.35s ease;
  }
  .onClock {
    opacity: 0;
    transition:
      opacity 2s ease,
      transform 0.35s ease;
  }
  .clockIcon-visible {
    opacity: 1;
  }
  .clockIcon-hidden {
    opacity: 0;
  }
</style>

<script>
  function initClockIcon() {
    const clockIcon: HTMLElement | null = document.getElementById("clockIcon");
    const clock: HTMLElement | null = document.getElementById("js-clock__inner");
    const ariaLiveStatusClockIcon: HTMLElement | null = document.getElementById("ariaLiveStatus__clockIcon");

    if (!clockIcon || !clock || !ariaLiveStatusClockIcon) {
      return;
    }

    // 要素を再取得（ページ遷移時にDOMが置き換えられるため）
    const onClockElements: NodeListOf<HTMLElement> = document.querySelectorAll(".onClock");
    const offClockElements: NodeListOf<HTMLElement> = document.querySelectorAll(".offClock");

    if (!onClockElements.length || !offClockElements.length) {
      return;
    }

    let isClockOff = clock.classList.contains("is-notClock");
    let ariaLabelClockIcon = isClockOff
      ? "時計の表示を切り替える（時計表示なし）"
      : "時計の表示を切り替える（時計表示あり）";
    let titleClockIcon = isClockOff
      ? "時計の表示を切り替える（時計表示なし）"
      : "時計の表示を切り替える（時計表示あり）";

    const updateAccessibilityClockIcon = () => {
      clockIcon.setAttribute("aria-label", ariaLabelClockIcon);
      clockIcon.setAttribute("title", titleClockIcon);
    };

    const updateClockIcons = () => {
      if (isClockOff) {
        offClockElements.forEach((offClock) => {
          offClock.classList.replace("clockIcon-visible", "clockIcon-hidden");
        });
        onClockElements.forEach((onClock) => {
          onClock.classList.replace("clockIcon-hidden", "clockIcon-visible");
        });
      } else {
        onClockElements.forEach((onClock) => {
          onClock.classList.replace("clockIcon-visible", "clockIcon-hidden");
        });
        offClockElements.forEach((offClock) => {
          offClock.classList.replace("clockIcon-hidden", "clockIcon-visible");
        });
      }
    };

    updateClockIcons();
    updateAccessibilityClockIcon();

    // 既存のイベントリスナーを削除してから新しいリスナーを追加
    const newClockIcon = clockIcon.cloneNode(true);
    clockIcon.parentNode?.replaceChild(newClockIcon, clockIcon);
    const newClockIconElement = document.getElementById("clockIcon");

    if (newClockIconElement) {
      newClockIconElement.addEventListener("click", () => {
        const currentClock = document.getElementById("js-clock__inner");
        const currentAriaLiveStatus = document.getElementById("ariaLiveStatus__clockIcon");
        if (!currentClock) return;

        isClockOff = currentClock.classList.toggle("is-notClock");

        if (isClockOff) {
          ariaLabelClockIcon = "時計の表示を切り替える（時計表示なし）";
          titleClockIcon = "時計の表示を切り替える（時計表示なし）";
          if (currentAriaLiveStatus) {
            currentAriaLiveStatus.textContent = "時計表示なしに切り替えました";
          }
        } else {
          ariaLabelClockIcon = "時計の表示を切り替える（時計表示あり）";
          titleClockIcon = "時計の表示を切り替える（時計表示あり）";
          if (currentAriaLiveStatus) {
            currentAriaLiveStatus.textContent = "時計表示ありに切り替えました";
          }
        }

        // 要素を再取得して更新
        const currentOnClockElements = document.querySelectorAll(".onClock");
        const currentOffClockElements = document.querySelectorAll(".offClock");
        const currentClockIcon = document.getElementById("clockIcon");

        if (currentClockIcon) {
          currentClockIcon.setAttribute("aria-label", ariaLabelClockIcon);
          currentClockIcon.setAttribute("title", titleClockIcon);
        }

        if (isClockOff) {
          currentOffClockElements.forEach((offClock) => {
            offClock.classList.replace("clockIcon-visible", "clockIcon-hidden");
          });
          currentOnClockElements.forEach((onClock) => {
            onClock.classList.replace("clockIcon-hidden", "clockIcon-visible");
          });
        } else {
          currentOnClockElements.forEach((onClock) => {
            onClock.classList.replace("clockIcon-visible", "clockIcon-hidden");
          });
          currentOffClockElements.forEach((offClock) => {
            offClock.classList.replace("clockIcon-hidden", "clockIcon-visible");
          });
        }
      });
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initClockIcon);
  } else {
    initClockIcon();
  }

  // View Transitions対応: ページ遷移時に再初期化
  document.addEventListener("astro:after-swap", () => {
    initClockIcon();
  });
</script>
