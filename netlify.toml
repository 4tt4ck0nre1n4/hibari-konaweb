[build]
  # ビルドコマンド（環境変数チェック付き）
  command = "npm run build:safe"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"
  # ビルドログを詳細にする
  NODE_OPTIONS = "--max-old-space-size=4096"

# WordPress uploads フォルダをコピーするためのディレクトリ設定
[build.processing]
  skip_processing = false

# 環境変数の設定
# 以下の環境変数をNetlify UIで設定してください：
# Site Settings → Environment Variables
#
# 必須:
#   PUBLIC_API_URL = https://your-production-wordpress-url.com
#   PUBLIC_API_PREFIX = /wp-json/wp/v2/
#
# オプション（Contact Form 7を使用する場合）:
#   PUBLIC_WPCF7_API_PREFIX = contact-form-7/v1/contact-forms/
#   PUBLIC_WPCF7_API_ID = 123
#   PUBLIC_WPCF7_ID = 123
#   PUBLIC_WPCF7_UNIT_TAG = wpcf7-f123-p456-o1
#   PUBLIC_WPCF7_POST_ID = 456

# キャッシュヘッダーの設定（PageSpeed Insights最適化）
# 画像ファイル（.webp, .jpg, .png, .gif, .svg, .ico）に1年間のキャッシュを設定
[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpeg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.gif"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.svg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.ico"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# CSS/JSファイル（ハッシュ付きファイル）に1年間のキャッシュを設定
[[headers]]
  for = "/_astro/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/_astro/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# フォントファイルに1年間のキャッシュを設定
[[headers]]
  for = "/*.woff"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.ttf"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.otf"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# その他の静的アセット（音声、動画、WASMなど）
[[headers]]
  for = "/*.mp3"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.mp4"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.wasm"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# HTMLファイルはキャッシュしない（常に最新版を取得）
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"
